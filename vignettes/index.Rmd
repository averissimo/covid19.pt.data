---
title: "COVID-19 Portugal data"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
devtools::load_all()
library(pdftools)
library(rvest)
library(tidyverse)
library(anytime)
library(futile.logger)
library(glue)
library(reshape2)
library(zoo)
library(usethis)

flog.threshold('info')
flog.layout(layout.format('~m'))
```

> R package with latest data scrapped from official sources

It downloads the [daily report](https://covid19.min-saude.pt/relatorio-de-situacao/) from DGS and stores this in data-friendly format under `/data` directory.

## Check for new reports

```{r, message=FALSE}
dat <- download.updated.pt()

dgs.pt.new     <- dat$dgs.pt
covid19.pt.new <- dat$cdc.eu
```

## Stores in the package

```{r}
# DGS PT
if (nrow(dgs.pt.new) != nrow(dgs.pt)) {
  dgs.pt <- dgs.pt.new
  usethis::use_data(dgs.pt, overwrite = TRUE)
  readr::write_csv(dgs.pt, path = '../data/dgs_pt.csv')
}

# EU CDC
covid19.pt <- tibble()
tryCatch(covid19.pt <- covid19.pt.data::covid19.pt, error = function(err) { })

if (nrow(covid19.pt.new) != nrow(covid19.pt)) {
  covid19.pt <- covid19.pt.new
  usethis::use_data(covid19.pt, overwrite = TRUE)
  readr::write_csv(covid19.pt, path = '../data/covid19_pt.csv')
}

```

## Data from DGS

```{r, echo=FALSE}
dgs.pt %>% arrange(desc(date)) %>% rmarkdown::paged_table()
```

## Data from EU CDC updated

```{r, message=FALSE}
covid19.pt.new %>% rmarkdown::paged_table()
```




